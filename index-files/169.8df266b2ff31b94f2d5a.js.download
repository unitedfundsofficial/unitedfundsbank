(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{hWRP:function(e,t,r){"use strict";function n(e,t){void 0===t&&(t=""),c.logDebug(e+" "+t)}function a(e,t){var r=t?JSON.stringify(t):"";m.logDebug(e+" "+r)}function s(e){var t,r;return e.method&&["create_alert","stop_alert","stop_all","restart_alert","restart_all","delete_alert","delete_all","delete_events","update_extra"].includes(e.method)&&(t=Object.assign({},e.params),e.params&&"extra"in e.params&&(t.extra=JSON.parse(e.params.extra)),h.logNormal(JSON.stringify({m:e.method,p:t}))),f.isMergable(e)?f.mergeRequest(e):l.isCachable(e)?((r=l.get(e))||(r=i(e),l.set(e,r)),r):i(e)}function i(e){var t,r=e.method,n={body:JSON.stringify({m:r,p:e.params}),credentials:"include",method:"POST",headers:e.headers},a=(new Date).getTime();return v?(t=window.user&&window.user.username?v+"?log_username="+window.user.username:v,Object(p.fetch)(t,n,{logBodyOnError:!0}).then(function(e){g.telemetry.sendReport("alerts","api_http_status",{value:e.status});var t=(new Date).getTime()-a;return g.telemetry.sendReport("alerts","api_time_frame",{value:t}),e.json()}).then(function(e){var t=e.m,r="Unexpected server response";return"success"===t?e.p:"error"===e.m?Promise.reject(e.p.reason||r):Promise.reject(r)}).catch(function(e){return e instanceof Error?Promise.reject("Failed to fetch price-alerts: "+e):Promise.reject(e)})):Promise.reject("no_alerts_url")}var o,u,c,l,d,m,f,g,p,h,v;r.r(t),o=r("Kxc7"),u=r("uOxu"),c=Object(u.getLogger)("Alerts.Price.RequestCache"),function(e){function t(e){var t=a(e);return s[t]&&n("got from cache",t),s[t]?s[t].self:null}function r(e,t){var r,i,o;void 0===t&&(t=!1),r=a(e),(i=s[r])&&(t?(i.clearCacheTimeoutId&&clearTimeout(i.clearCacheTimeoutId),delete s[r],n("removed immediately",r)):(o=5e3,i.clearCacheTimeoutId=setTimeout(function(){delete s[r],n("removed timeout",r)},o)))}function a(e){return JSON.stringify(e)}var s={};e.set=function(e,i){var o=a(e);t(e)&&r(e,!0),s[o]={self:i},n("added",o),i.then(function(t){return r(e),t}).catch(function(t){return r(e,!0),t})},e.get=t,e.isCachable=function(e){return"list_alerts"===e.method||"list_events"===e.method}}(l||(l={})),d=r("0waE"),m=Object(u.getLogger)("Alerts.Price.MergedGetAlertsRequrest"),function(e){function t(e){delete n[e],Object.keys(n).length||(o=null,s=null)}var r=500,n={},s=null,o=null;e.isMergable=function(e){return"get_alert"===e.method||"get_alerts"===e.method},e.mergeRequest=function(e){var u=Object(d.guid)(),c=new Promise(function(t,n){a("personal promise - creating",e),function(e){var t=[];"id"in e.params?t=[e.params.id]:"ids"in e.params&&(t=e.params.ids),o?o.params.ids=o.params.ids.concat(t):o={method:"get_alerts",params:{ids:t}}}(e),(s||(a("merged promise - creating"),(s=new Promise(function(e,t){setTimeout(function(){o?(a("send request to server - timeout"),i(o).then(function(t){e(t)}).catch(t)):t("No data to send request")},r)})).then(function(e){return a("merged promise - resolved")}),s.catch(function(e){return a("merged promise - rejected")})),s).then(function(r){var s=function(e,t){
var r,n,a,s,i,o,u,c=t.alerts||[],l=null;if("get_alert"===e.method)(r=c.filter(function(t){return t.id===e.params.id})[0])&&(l={alert:r});else if("get_alerts"===e.method){for(n=e.params.ids,a=[],s=n.length-1;s>=0;s--)for(i=n[s],o=c.length-1;o>=0;o--)if((u=c[o]).id===i){a.push(u);break}a.length&&(l={alerts:a})}return l}(e,r);s?(a("personal promise - resolved",e),t(s)):(a("personal promise - rejected",e),n("not_exists"))}).catch(n)});return c.then(function(e){return t(u),e}).catch(function(e){return t(u),e}),function(e,t){n[e]=t}(u,c),c}}(f||(f={})),g=r("xlbu"),p=r("BHQF"),r.d(t,"sendRequest",function(){return s}),r.d(t,"sendRequestImmediately",function(){return i}),h=Object(u.getLogger)("Alerts.Price.Request"),v=window.initData.price_alerts_url||"",o.enabled("alerts")&&!v&&h.logError("Url not passed")}}]);